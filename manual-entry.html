<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powerball Manual Entry</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .date-fields {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .date-fields .form-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-fields label {
            min-width: 100px;
            font-weight: 500;
        }
        
        .date-fields input[type="date"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        
        .form-note {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #4a90e2;
        }
        
        .form-note p {
            margin: 0;
            color: #555;
            font-size: 0.95em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #e74c3c;
            margin-top: 5px;
        }
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-section {
            margin: 25px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .stat-section h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .draw-card {
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid #e9ecef;
        }
        
        .draw-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        .draw-card.dp {
            background-color: #f8f9fa;
            border-left: 4px solid #4a90e2;
        }
        
        .analysis-box {
            padding: 15px;
            background: #f8f9fa;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.75em;
            color: #6c757d;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .numbers-box {
            padding: 20px;
            border-bottom: 1px solid #f1f3f5;
            background: #fff;
        }
        
        .draw-numbers {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 0 auto;
            max-width: 360px;
        }
        
        .number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f1f3f5;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .powerball-badge {
            background: #f1c40f;
            color: #000;
        }
        
        .draw-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .delete-btn {
            background: #fff5f5;
            border: 1px solid #ffd6d6;
            color: #e74c3c;
            font-size: 1em;
            cursor: pointer;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: #ffebeb;
            transform: scale(1.1);
        }
        
        .btn-save {
            background-color: #28a745;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #218838;
        }
        
        .btn-download {
            background-color: #007bff;
            color: white;
        }
        
        .btn-download:hover {
            background-color: #0056b3;
        }
        
        .btn-clear {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #c82333;
        }
        
        .draws-list {
            margin-top: 30px;
        }
        
        .draw-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .draw-date {
            font-weight: 600;
            color: #333;
        }
        
        .entry-form {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .form-row label {
            min-width: 120px;
            font-weight: 600;
        }
        
        input[type="number"] {
            width: 70px;
            height: 40px;
            text-align: center;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }
        
        .number-inputs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .number-inputs input {
            flex: 0 0 auto;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .draws-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
            padding: 0 5px;
        }
        
        .draw-box {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            font-size: 0.9em;
        }
        
        .draw-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .draw-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .number-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 12px 0;
        }
        
        .number-inputs input {
            width: 32px;
            height: 32px;
            text-align: center;
            padding: 3px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .number-inputs input:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            outline: none;
        }
        
        .number-inputs input[placeholder*="PB"] {
            background-color: #fff5f7;
            font-weight: bold;
            color: #e91e63;
        }
        
        .analysis-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px dashed #f0f0f0;
        }
        
        .analysis-field {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 4px 6px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .analysis-field:hover {
            background: #f0f4f8;
        }
        
        .analysis-field label {
            font-size: 10px;
            margin-right: 4px;
            color: #666;
            min-width: 40px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .analysis-field input {
            width: 36px;
            padding: 2px 4px;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
            background: white;
        }
        
        .analysis-field input:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            outline: none;
        }
        
        .pairs-with {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px dashed #eee;
        }
        
        .pairs-with label {
            display: block;
            font-size: 10px;
            color: #666;
            margin-bottom: 4px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .pairs-with textarea {
            width: 100%;
            min-height: 40px;
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            resize: vertical;
        }
        
        .pairs-with textarea:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            outline: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lottery Draw Analysis</h1>
        
        <div class="entry-form card">
            <h2>Draw Analysis</h2>
            <div class="draws-grid">
                <!-- Draw boxes will be added here by JavaScript -->
            </div>
        </div>
        
        <div class="buttons">
            <button class="btn-save" id="saveBtn">Save All Draws</button>
            <button class="btn-download" id="downloadBtn">Download Data</button>
            <button class="btn-clear" id="clearBtn">Clear All</button>
        </div>
    </div>
    
    <div class="draws-list" id="drawsList">
        <!-- Saved draws will appear here -->
    </div>

    <script>
        // Global variables
        let draws = [];
        const NUM_DRAWS = 10;
        
        // Initialize the page with date fields
        function initializeDrawForms() {
            // Set today's date as default for all date fields
            const today = new Date().toISOString().split('T')[0];
            for (let i = 0; i < 10; i++) {
                const dateInput = document.getElementById(`drawDate${i}`);
                if (dateInput) dateInput.value = today;
            }
        }
        
        // Helper function to get draw data from form
        function getDrawData(drawIndex) {
            // Get main numbers (1-5)
            const mainNums = [];
            for (let i = 1; i <= 5; i++) {
                const val = document.getElementById(`num${drawIndex}_${i}`)?.value;
                if (val && !isNaN(val)) mainNums.push(parseInt(val));
            }
            
            // Get Double Play numbers (1-5)
            const dpNums = [];
            for (let i = 1; i <= 5; i++) {
                const val = document.getElementById(`dp_num${drawIndex}_${i}`)?.value;
                if (val && !isNaN(val)) dpNums.push(parseInt(val));
            }
            
            // Get analysis data for this draw
            const analysis = {
                sum: document.getElementById(`sum_${drawIndex}`)?.value ? parseInt(document.getElementById(`sum_${drawIndex}`).value) : null,
                sumWithPB: document.getElementById(`sumWithPB_${drawIndex}`)?.value ? parseInt(document.getElementById(`sumWithPB_${drawIndex}`).value) : null,
                odds: document.getElementById(`odds_${drawIndex}`)?.value ? parseInt(document.getElementById(`odds_${drawIndex}`).value) : 0,
                evens: document.getElementById(`evens_${drawIndex}`)?.value ? parseInt(document.getElementById(`evens_${drawIndex}`).value) : 0,
                lows: document.getElementById(`lows_${drawIndex}`)?.value ? parseInt(document.getElementById(`lows_${drawIndex}`).value) : 0,
                highs: document.getElementById(`highs_${drawIndex}`)?.value ? parseInt(document.getElementById(`highs_${drawIndex}`).value) : 0,
                sameEnding: document.getElementById(`sameEnding_${drawIndex}`)?.value ? parseInt(document.getElementById(`sameEnding_${drawIndex}`).value) : 0,
                consecutive: document.getElementById(`consecutive_${drawIndex}`)?.value ? parseInt(document.getElementById(`consecutive_${drawIndex}`).value) : 0,
                neighbors: document.getElementById(`neighbors_${drawIndex}`)?.value ? parseInt(document.getElementById(`neighbors_${drawIndex}`).value) : 0,
                groupOmitted: document.getElementById(`groupOmitted_${drawIndex}`)?.value || '0',
                lowEnd: document.getElementById(`lowEnd_${drawIndex}`)?.value ? parseInt(document.getElementById(`lowEnd_${drawIndex}`).value) : null,
                highEnd: document.getElementById(`highEnd_${drawIndex}`)?.value ? parseInt(document.getElementById(`highEnd_${drawIndex}`).value) : null,
                pairsWith: document.getElementById(`pairsWith_${drawIndex}`)?.value || ''
            };
            
            return {
                id: Date.now() + drawIndex,
                date: document.getElementById(`drawDate${drawIndex}`)?.value || new Date().toISOString().split('T')[0],
                numbers: mainNums.length === 5 ? mainNums : null,
                powerball: parseInt(document.getElementById(`powerball${drawIndex}`)?.value) || null,
                dpNumbers: dpNums.length === 5 ? dpNums : null,
                dpPowerball: parseInt(document.getElementById(`dp_powerball${drawIndex}`)?.value) || null,
                analysis: Object.values(analysis).some(v => v !== null) ? analysis : null,
                timestamp: new Date().toISOString()
            };
        }
        
        
        // Function to create draw boxes with analysis fields
        function createDrawBoxes() {
            const drawsGrid = document.querySelector('.draws-grid');
            if (!drawsGrid) return;
            
            drawsGrid.innerHTML = ''; // Clear existing content
            
            for (let i = 0; i < 10; i++) {
                const drawBox = document.createElement('div');
                drawBox.className = 'draw-box';
                drawBox.innerHTML = `
                    <div class="draw-header">Draw ${i + 1}</div>
                    <div class="form-group">
                        <label>Date:</label>
                        <input type="date" id="drawDate${i}" class="draw-date" style="width: 100%; margin-bottom: 10px;">
                    </div>
                    
                    <div class="form-group">
                        <label>Main Numbers:</label>
                        <div class="number-inputs">
                            ${Array(5).fill().map((_, j) => 
                                `<input type="number" id="num${i}_${j+1}" min="1" max="69" placeholder="#${j+1}">`
                            ).join('')}
                            <input type="number" id="powerball${i}" min="1" max="26" placeholder="PB" style="color: #e91e63; font-weight: bold;">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 10px;">
                        <label>Double Play:</label>
                        <div class="number-inputs">
                            ${Array(5).fill().map((_, j) => 
                                `<input type="number" id="dp_num${i}_${j+1}" min="1" max="69" placeholder="#${j+1}">`
                            ).join('')}
                            <input type="number" id="dp_powerball${i}" min="1" max="26" placeholder="PB" style="color: #e91e63; font-weight: bold;">
                        </div>
                    </div>
                    
                    <div class="analysis-fields">
                        <div class="analysis-field">
                            <label>Sum:</label>
                            <input type="number" id="sum_${i}" min="15" max="365">
                        </div>
                        <div class="analysis-field">
                            <label>Sum w/PB:</label>
                            <input type="number" id="sumWithPB_${i}" min="16" max="391">
                        </div>
                        <div class="analysis-field">
                            <label>Odds:</label>
                            <input type="number" id="odds_${i}" min="0" max="5">
                        </div>
                        <div class="analysis-field">
                            <label>Evens:</label>
                            <input type="number" id="evens_${i}" min="0" max="5">
                        </div>
                        <div class="analysis-field">
                            <label>Lows (1-35):</label>
                            <input type="number" id="lows_${i}" min="0" max="5">
                        </div>
                        <div class="analysis-field">
                            <label>Highs (36-69):</label>
                            <input type="number" id="highs_${i}" min="0" max="5">
                        </div>
                        <div class="analysis-field">
                            <label>Same End:</label>
                            <input type="number" id="sameEnding_${i}" min="0" max="4">
                        </div>
                        <div class="analysis-field">
                            <label>Consec.:</label>
                            <input type="number" id="consecutive_${i}" min="0" max="4">
                        </div>
                        <div class="analysis-field">
                            <label>Neighbors:</label>
                            <input type="number" id="neighbors_${i}" min="0" max="4">
                        </div>
                        <div class="analysis-field">
                            <label>Grp Omit:</label>
                            <input type="number" id="groupOmitted_${i}" min="0" max="3">
                        </div>
                        <div class="analysis-field">
                            <label>Low End:</label>
                            <input type="number" id="lowEnd_${i}" min="1" max="9">
                        </div>
                        <div class="analysis-field">
                            <label>High End:</label>
                            <input type="number" id="highEnd_${i}" min="1" max="9">
                        </div>
                        <div class="pairs-with">
                            <label>Pairs With:</label>
                            <textarea id="pairsWith_${i}" rows="2" placeholder="Enter number pairs (e.g., 5-10, 15-20)"></textarea>
                        </div>
                    </div>
                `;
                drawsGrid.appendChild(drawBox);
            }
        }

        // Initialize the application
        // Set up form event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize date fields
            const dateFieldsContainer = document.getElementById('dateFields');
            if (dateFieldsContainer) {
                dateFieldsContainer.innerHTML = Array(10).fill().map((_, i) => `
                    <div class="form-row">
                        <label for="drawDate${i}">Draw ${i + 1} Date:</label>
                        <input type="date" id="drawDate${i}" class="draw-date">
                    </div>
                `).join('');
                
                // Set focus to first date input
                const firstDateInput = document.querySelector('.draw-date');
                if (firstDateInput) firstDateInput.focus();
            }
            
            // Create draw boxes with analysis fields
            createDrawBoxes();
            
            // Set up event listeners
            document.getElementById('saveBtn').addEventListener('click', saveDraw);
            document.getElementById('clearBtn').addEventListener('click', clearAllForms);
            document.getElementById('downloadBtn').addEventListener('click', downloadData);
            
            // Initial render
            renderDraws();
        });
        
        function saveDraw() {
            try {
                const savedDraws = [];
                
                // Process each of the 10 draws
                for (let i = 0; i < 10; i++) {
                    const date = document.getElementById(`drawDate${i}`)?.value;
                    if (!date) continue; // Skip if no date provided
                    
                    // Get analysis values for this draw
                    const analysis = {
                        sum: document.getElementById(`sum_${i}`)?.value ? parseInt(document.getElementById(`sum_${i}`).value) : null,
                        sumWithPB: document.getElementById(`sumWithPB_${i}`)?.value ? parseInt(document.getElementById(`sumWithPB_${i}`).value) : null,
                        odds: document.getElementById(`odds_${i}`)?.value ? parseInt(document.getElementById(`odds_${i}`).value) : null,
                        evens: document.getElementById(`evens_${i}`)?.value ? parseInt(document.getElementById(`evens_${i}`).value) : null,
                        lows: document.getElementById(`lows_${i}`)?.value ? parseInt(document.getElementById(`lows_${i}`).value) : null,
                        highs: document.getElementById(`highs_${i}`)?.value ? parseInt(document.getElementById(`highs_${i}`).value) : null,
                        sameEnding: document.getElementById(`sameEnding_${i}`)?.value ? parseInt(document.getElementById(`sameEnding_${i}`).value) : null,
                        consecutive: document.getElementById(`consecutive_${i}`)?.value ? parseInt(document.getElementById(`consecutive_${i}`).value) : null,
                        neighbors: document.getElementById(`neighbors_${i}`)?.value ? parseInt(document.getElementById(`neighbors_${i}`).value) : null,
                        groupOmitted: document.getElementById(`groupOmitted_${i}`)?.value || null,
                        lowEnd: document.getElementById(`lowEnd_${i}`)?.value ? parseInt(document.getElementById(`lowEnd_${i}`).value) : null,
                        highEnd: document.getElementById(`highEnd_${i}`)?.value ? parseInt(document.getElementById(`highEnd_${i}`).value) : null,
                        hit10: document.getElementById(`hit10_${i}`)?.value ? parseInt(document.getElementById(`hit10_${i}`).value) : null,
                        hit25: document.getElementById(`hit25_${i}`)?.value ? parseInt(document.getElementById(`hit25_${i}`).value) : null,
                        hit50: document.getElementById(`hit50_${i}`)?.value ? parseInt(document.getElementById(`hit50_${i}`).value) : null
                    };
                    
                    // Create draw object
                    const draw = {
                        id: `${Date.now()}_${i}`,
                        date: date,
                        numbers: [],
                        powerball: null,
                        dpNumbers: null,
                        dpPowerball: null,
                        analysis: Object.values(analysis).some(v => v !== null) ? analysis : null,
                        timestamp: new Date().toISOString()
                    };
                    
                    savedDraws.push(draw);
                }
                
                if (savedDraws.length === 0) {
                    alert('Please enter at least one draw date');
                    return;
                }
                
                // Save to localStorage
                const existingDraws = JSON.parse(localStorage.getItem('powerballDraws') || '[]');
                const updatedDraws = [...existingDraws, ...savedDraws];
                localStorage.setItem('powerballDraws', JSON.stringify(updatedDraws));
                
                // Update UI
                renderDraws();
                
                // Clear form
                clearAllForms();
                
                // Show success message
                alert(`Successfully saved ${savedDraws.length} draw(s)!`);
            } catch (error) {
                console.error('Error saving draw:', error);
                alert('An error occurred while saving the draw. Please check the console for details.');
            }
        }
        
        function renderDraws() {
            const drawsList = document.getElementById('drawsList');
            if (!drawsList) return;

            const draws = JSON.parse(localStorage.getItem('powerballDraws') || '[]');

            if (draws.length === 0) {
                drawsList.innerHTML = '<p>No saved draws yet. Add your first draw above.</p>';
                return;
            }
            
            // Clear all analysis boxes first
            for (let i = 0; i < 10; i++) {
                const clearValue = (id) => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                };
                
                // Clear all analysis fields
                clearValue(`sum_${i}`);
                clearValue(`sumWithPB_${i}`);
                clearValue(`odds_${i}`);
                clearValue(`evens_${i}`);
                clearValue(`lows_${i}`);
                clearValue(`highs_${i}`);
                clearValue(`sameEnding_${i}`);
                clearValue(`consecutive_${i}`);
                clearValue(`neighbors_${i}`);
                clearValue(`lowEnd_${i}`);
                clearValue(`highEnd_${i}`);
                clearValue(`hit10_${i}`);
                clearValue(`hit25_${i}`);
                clearValue(`hit50_${i}`);
                
                const groupEl = document.getElementById(`groupOmitted_${i}`);
                if (groupEl) groupEl.selectedIndex = 0;
            }
            
            // Update analysis boxes with saved data (up to 10 most recent)
            const recentDraws = [...draws].reverse().slice(0, 10);
            recentDraws.forEach((draw, index) => {
                if (!draw.analysis) return;
                
                const setValue = (id, value) => {
                    const el = document.getElementById(id);
                    if (el && value !== null && value !== undefined) el.value = value;
                };
                
                const analysis = draw.analysis;
                
                // Set values for each analysis field
                setValue(`sum_${index}`, analysis.sum);
                setValue(`sumWithPB_${index}`, analysis.sumWithPB);
                setValue(`odds_${index}`, analysis.oddsEvens?.odds);
                setValue(`evens_${index}`, analysis.oddsEvens?.evens);
                setValue(`lows_${index}`, analysis.lowHigh?.lows);
                setValue(`highs_${index}`, analysis.lowHigh?.highs);
                setValue(`sameEnding_${index}`, analysis.sameEnding);
                setValue(`consecutive_${index}`, analysis.consecutive);
                setValue(`neighbors_${index}`, analysis.neighbors);
                setValue(`lowEnd_${index}`, analysis.lowHighEnd?.low);
                setValue(`highEnd_${index}`, analysis.lowHighEnd?.high);
                setValue(`hit10_${index}`, analysis.hits?.hit10);
                setValue(`hit25_${index}`, analysis.hits?.hit25);
                setValue(`hit50_${index}`, analysis.hits?.hit50);
                
                const groupEl = document.getElementById(`groupOmitted_${index}`);
                if (groupEl && analysis.groupOmitted) {
                    const option = Array.from(groupEl.options).find(
                        opt => opt.value === analysis.groupOmitted
                    );
                    if (option) option.selected = true;
                }
            });

            let html = '<div class="draws-grid">';

            draws.forEach(draw => {
                // Main draw
                html += `
                    <div class="draw-card">
                        <div class="draw-header">
                            <span class="draw-date">${draw.date}</span>
                            <button class="delete-btn" data-id="${draw.id}" title="Delete draw">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="numbers-box">
                            <div class="draw-numbers">
                                ${draw.numbers.map(n => `<span class="number">${n}</span>`).join('')}
                                ${draw.powerball ? `<span class="powerball">${draw.powerball}</span>` : ''}
                            </div>
                        </div>`;
                
                // Add analysis summary if available
                if (draw.analysis) {
                    html += `
                        <div class="analysis-box">
                            <div class="analysis-grid">
                                <div class="stat-item">
                                    <div class="stat-label">Sum</div>
                                    <div class="stat-value">${draw.analysis.sum || 'N/A'}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Odd/Even</div>
                                    <div class="stat-value">${draw.analysis.odds || 0}/${draw.analysis.evens || 0}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Low/High</div>
                                    <div class="stat-value">${draw.analysis.lows || 0}/${draw.analysis.highs || 0}</div>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Range</span>
                                    <span class="stat-value">${draw.analysis.lowHighEnd?.low || 'N/A'}-${draw.analysis.lowHighEnd?.high || 'N/A'}</span>
                                </div>
                            </div>`;
                    
                    // Add notes if available
                    if (draw.analysis.notes) {
                        html += `
                            <div class="notes">
                                <strong>📝</strong> ${draw.analysis.notes}
                            </div>`;
                    }
                    
                    html += `</div>`;
                }
                
                html += `
                </div>`;

                // Double Play draw if it exists
                if (draw.dpNumbers) {
                    html += `
                        <div class="draw-card dp">
                            <div class="draw-header">
                                <div>
                                    <span class="draw-date">${draw.date}</span>
                                    <span class="draw-type">Double Play</span>
                                </div>
                            </div>
                            <div class="draw-numbers">
                                ${draw.dpNumbers.map(n => `<span class="number">${n}</span>`).join('')}
                                ${draw.dpPowerball ? `<span class="powerball">${draw.dpPowerball}</span>` : ''}
                            </div>
                        </div>`;
                }
            });
            
            html += '</div>';
            drawsList.innerHTML = html;
        }
            
        // Download data as Text
        function downloadData() {
            try {
                const draws = JSON.parse(localStorage.getItem('powerballDraws') || '[]');
                
                if (draws.length === 0) {
                    alert('No data to download');
                    return;
                }
                
                // Create text content
                let textContent = 'LOTTERY DRAWS AND ANALYSIS\n\n';
                
                draws.forEach((draw, index) => {
                    textContent += `=== DRAW #${index + 1} (${draw.date}) ===\n`;
                    textContent += `Main Numbers: ${draw.numbers.join(', ')} | Powerball: ${draw.powerball}\n`;
                    
                    if (draw.dpNumbers) {
                        textContent += `Double Play: ${draw.dpNumbers.join(', ')} | Powerball: ${draw.dpPowerball}\n`;
                    }
                    
                    // Add analysis data if available
                    if (draw.analysis) {
                        textContent += '\nANALYSIS\n';
                        textContent += `Sum: ${draw.analysis.sum || 'N/A'}\n`;
                        textContent += `Sum with Powerball: ${draw.analysis.sumWithPB || 'N/A'}\n`;
                        textContent += `Odd/Even: ${draw.analysis.oddsEvens.odds} odd / ${draw.analysis.oddsEvens.evens} even\n`;
                        textContent += `Low/High (≤35): ${draw.analysis.lowHigh.lows} low / ${draw.analysis.lowHigh.highs} high\n`;
                        textContent += `Same Endings: ${draw.analysis.sameEnding || '0'}\n`;
                        textContent += `Consecutive Pairs: ${draw.analysis.consecutive || '0'}\n`;
                        textContent += `Neighboring Pairs: ${draw.analysis.neighbors || '0'}\n`;
                        textContent += `Group Omitted: ${draw.analysis.groupOmitted || 'None'}\n`;
                        textContent += `Low/High End: ${draw.analysis.lowHighEnd.low} / ${draw.analysis.lowHighEnd.high}\n`;
                        textContent += `Hits (≤10/≤25/≤50): ${draw.analysis.hits.hit10}/${draw.analysis.hits.hit25}/${draw.analysis.hits.hit50}\n`;
                    }
                    
                    textContent += '\n' + '-'.repeat(50) + '\n\n';
                });
                
                // Create download link
                const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                // Create and trigger download
                const link = document.createElement('a');
                link.href = url;
                link.download = `lottery_data_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(link);
                link.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
            } catch (error) {
                console.error('Error downloading data:', error);
                alert('Error downloading data. Please check the console for details.');
            }
        }
            
        // Clear all forms function
        function clearAllForms() {
            // Set today's date for all date fields
            const currentDate = new Date().toISOString().split('T')[0];
            for (let i = 0; i < 10; i++) {
                const dateInput = document.getElementById(`drawDate${i}`);
                if (dateInput) dateInput.value = currentDate;
                
                // Clear all analysis fields for this draw
                const clearValue = (id) => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                };
                
                // Clear all analysis fields
                clearValue(`sum_${i}`);
                clearValue(`sumWithPB_${i}`);
                clearValue(`odds_${i}`);
                clearValue(`evens_${i}`);
                clearValue(`lows_${i}`);
                clearValue(`highs_${i}`);
                clearValue(`sameEnding_${i}`);
                clearValue(`consecutive_${i}`);
                clearValue(`neighbors_${i}`);
                clearValue(`lowEnd_${i}`);
                clearValue(`highEnd_${i}`);
                clearValue(`hit10_${i}`);
                clearValue(`hit25_${i}`);
                clearValue(`hit50_${i}`);
                
                const groupEl = document.getElementById(`groupOmitted_${i}`);
                if (groupEl) groupEl.selectedIndex = 0;
            }
            
            // Clear all analysis boxes (0-9)
            for (let i = 0; i < 10; i++) {
                const clearValue = (id) => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                };
                
                // Clear all analysis fields
                clearValue(`sum_${i}`);
                clearValue(`sumWithPB_${i}`);
                clearValue(`odds_${i}`);
                clearValue(`evens_${i}`);
                clearValue(`lows_${i}`);
                clearValue(`highs_${i}`);
                clearValue(`sameEnding_${i}`);
                clearValue(`consecutive_${i}`);
                clearValue(`neighbors_${i}`);
                clearValue(`lowEnd_${i}`);
                clearValue(`highEnd_${i}`);
                clearValue(`hit10_${i}`);
                clearValue(`hit25_${i}`);
                clearValue(`hit50_${i}`);
                
                const groupEl = document.getElementById(`groupOmitted_${i}`);
                if (groupEl) groupEl.selectedIndex = 0;
            }
            
            // Set today's date in all date fields
            const today = new Date().toISOString().split('T')[0];
            for (let i = 0; i < NUM_DRAWS; i++) {
                const dateInput = document.getElementById(`drawDate${i}`);
                if (dateInput) dateInput.value = today;
            }
        }
            
        // Delete a draw by ID
        function deleteDraw(id) {
            if (!confirm('Are you sure you want to delete this draw?')) return;
            
            const draws = JSON.parse(localStorage.getItem('powerballDraws') || '[]');
            const updatedDraws = draws.filter(draw => draw.id !== id);
            localStorage.setItem('powerballDraws', JSON.stringify(updatedDraws));
            renderDraws();
        }
            
        // Set up form event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeDrawForms();
            
            // Load saved draws
            draws = JSON.parse(localStorage.getItem('powerballDraws') || '[]');
            
            // Set default date to today for all forms
            const today = new Date().toISOString().split('T')[0];
            for (let i = 0; i < NUM_DRAWS; i++) {
                const dateInput = document.getElementById(`drawDate${i}`);
                if (dateInput) dateInput.value = today;
            }
            
            // Initial render
            renderDraws();
            
            // Set up event delegation for delete buttons
            document.addEventListener('click', (e) => {
                if (e.target.closest('.delete-btn')) {
                    const deleteBtn = e.target.closest('.delete-btn');
                    const id = parseInt(deleteBtn.getAttribute('data-id'));
                    if (!isNaN(id)) {
                        deleteDraw(id);
                    }
                }
            });
            
            // Save button
            const saveBtn = document.getElementById('saveBtn');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveDraw);
            }
            
            // Clear button
            const clearBtn = document.getElementById('clearBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', clearAllForms);
            }
            
            // Download button
            const downloadBtn = document.getElementById('downloadBtn');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', downloadData);
            }
            
            // Auto-tab between number inputs
            document.addEventListener('input', (e) => {
                if (e.target.matches('.main-num, .pb-num, .dp-num, .dp-pb-num')) {
                    const input = e.target;
                    if (input.value.length >= input.maxLength) {
                        const form = input.closest('.draw-form');
                        if (form) {
                            const inputs = form.querySelectorAll('input[type="number"]');
                            const currentIndex = Array.from(inputs).indexOf(input);
                            if (currentIndex < inputs.length - 1) {
                                inputs[currentIndex + 1].focus();
                            }
                        }
                    }
                }
            });
        });
        </script>
</body>
</html>
